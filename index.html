<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Company Profile Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.1.1",
    "react-dom/": "https://esm.sh/react-dom@^19.1.1/",
    "react/": "https://esm.sh/react@^19.1.1/",
    "recharts": "https://esm.sh/recharts@^3.1.2"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body class="bg-slate-100">
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useMemo, createRef, forwardRef, useEffect } = React;
      const { PieChart, Pie, Cell, ResponsiveContainer } = Recharts;
      const { jsPDF } = jspdf;

      // --- ICONS ---
      const BuildingIcon = ({ className = "h-8 w-8 text-gray-400" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6h1.5m-1.5 3h1.5m-1.5 3h1.5M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21m0 0h-4.5m4.5 0v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21m0 0h-4.5" />
          </svg>
      );
      const LocationIcon = ({ className = "h-5 w-5 text-gray-400" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
              <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
          </svg>
      );
      const LinkedInIcon = ({ className = "h-5 w-5 text-gray-400" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" />
          </svg>
      );
      const SocialIcon = ({ className = "h-5 w-5 text-gray-400" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
          </svg>
      );
      const PhoneIcon = ({ className = "h-5 w-5 text-gray-400" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 6.75z" />
          </svg>
      );
      const WebsiteIcon = ({ className = "h-5 w-5 text-gray-400" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.916 17.916 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418" />
          </svg>
      );
      const UserIcon = ({ className = "h-5 w-5 text-gray-400" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
          </svg>
      );
      const BriefcaseIcon = ({ className = "h-5 w-5 text-gray-400" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M20.25 14.15v4.07a2.25 2.25 0 01-2.25 2.25H5.92a2.25 2.25 0 01-2.25-2.25v-4.07a2.25 2.25 0 01.99-1.855l4.5-3.25a2.25 2.25 0 012.52 0l4.5 3.25a2.25 2.25 0 01.99 1.854z" />
              <path strokeLinecap="round" strokeLinejoin="round" d="M16.5 21v-5.25a2.25 2.25 0 00-2.25-2.25H9.75A2.25 2.25 0 007.5 15.75V21" />
          </svg>
      );
      const TagIcon = ({ className = "h-5 w-5 text-gray-400" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
              <path strokeLinecap="round" strokeLinejoin="round" d="M6 6h.008v.008H6V6z" />
          </svg>
      );
      const NextActionsIcon = ({ className = "h-5 w-5 text-gray-400" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M15 15l-6 6m0 0l-6-6m6 6V9a6 6 0 0112 0v3" />
          </svg>
      );
      const DownloadIcon = ({ className = "h-5 w-5" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
          </svg>
      );
      const CalendarIcon = ({ className = "h-5 w-5 text-gray-400" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0h18M-4.5 12h27" />
          </svg>
      );
      const EmailIcon = ({ className = "h-5 w-5 text-gray-400" }) => (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
          </svg>
      );
      const StarIcon = ({ className = "h-5 w-5", filled = false }) => (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth={1.5} className={className}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
          </svg>
      );
      
      // --- HELPERS ---
      const formatCurrency = (value) => {
          return new Intl.NumberFormat('en-US', {
              style: 'currency',
              currency: 'USD',
              minimumFractionDigits: 0,
              maximumFractionDigits: 0,
          }).format(value);
      };
      const formatDate = (dateString) => {
          if (!dateString) return 'N/A';
          return new Date(`${dateString}T00:00:00`).toLocaleDateString('en-US', {
              month: 'short',
              day: 'numeric',
              year: 'numeric',
          });
      };
      const capitalizeFirstLetter = (string) => {
          if (!string) return '';
          return string.charAt(0).toUpperCase() + string.slice(1);
      }

      // --- COMPONENTS ---
      const MarketShareChart = ({ share }) => {
          const percentage = share * 100;
          const data = [
              { name: 'Market Share', value: percentage },
              { name: 'Rest', value: 100 - percentage },
          ];
          const COLORS = ['#3B82F6', '#E5E7EB'];

          return (
              <div className="relative w-32 h-32 mx-auto">
                  <ResponsiveContainer width="100%" height="100%">
                      <PieChart>
                          <Pie
                              data={data}
                              cx="50%"
                              cy="50%"
                              innerRadius={35}
                              outerRadius={45}
                              startAngle={90}
                              endAngle={450}
                              dataKey="value"
                              stroke="none"
                          >
                              {data.map((entry, index) => (
                                  <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                              ))}
                          </Pie>
                      </PieChart>
                  </ResponsiveContainer>
                  <div className="absolute inset-0 flex items-center justify-center">
                      <span className="text-xl font-bold text-gray-800">{percentage.toFixed(2)}%</span>
                  </div>
              </div>
          );
      };

      const StarRating = ({ rating, maxRating = 3 }) => {
          return (
              <div className="flex items-center">
                  {[...Array(maxRating)].map((_, index) => (
                      <StarIcon key={index} filled={index < rating} className={`h-5 w-5 ${index < rating ? 'text-yellow-400' : 'text-gray-300'}`} />
                  ))}
              </div>
          );
      };
      
      const InfoItem = ({ icon, label, children }) => (
          <div className="grid grid-cols-[auto_1fr] gap-x-3">
              <div className="row-span-2 self-start pt-1">{icon}</div>
              <p className="col-start-2 text-sm text-gray-500">{label}</p>
              <div className="col-start-2 text-sm text-gray-800 font-medium">{children}</div>
          </div>
      );

      const PipelineInfoItem = ({ icon, label, children }) => (
          <div className="flex items-center gap-x-3">
              <div className="flex-shrink-0 pt-1">{icon}</div>
              <div className="w-20 text-sm text-gray-500 flex-shrink-0">{label}</div>
              <div className="text-sm text-gray-800 font-medium">{children}</div>
          </div>
      );

      const Dashboard = forwardRef(({ company }, ref) => {
          const pipelineStatusColor = {
            negotation: 'bg-green-100 text-green-800',
            engaged: 'bg-blue-100 text-blue-800',
            contacted: 'bg-yellow-100 text-yellow-800',
            disqualified: 'bg-red-100 text-red-800'
          };

          const interestLevelColor = {
            warm: 'bg-yellow-100 text-yellow-800',
            cold: 'bg-blue-100 text-blue-800',
            disqualified: 'bg-gray-100 text-gray-800'
          };
          
          const Badge = ({ children, className }) => (
              <span className={`text-xs font-semibold px-3 py-1 rounded-full inline-block ${className}`}>
                {children}
              </span>
          );

          return (
              <div className="bg-white rounded-xl shadow-lg p-6 md:p-8 w-full font-sans" ref={ref}>
                  <header className="flex items-center justify-between pb-6">
                      <div className="flex items-center space-x-4">
                          <div className="bg-slate-100 p-3 rounded-lg">
                              <BuildingIcon />
                          </div>
                          <div>
                              <h1 className="text-2xl font-bold text-gray-800">{company.company}</h1>
                              <p className="text-sm text-gray-500">{company.ruc}</p>
                          </div>
                      </div>
                      <div className="flex items-center space-x-2">
                          <Badge className="bg-blue-100 text-blue-700">{company.tier}</Badge>
                      </div>
                  </header>
                  <hr />
                  <section className="grid grid-cols-1 md:grid-cols-3 gap-6 py-6">
                      <div className="bg-slate-50 p-6 rounded-lg text-center">
                          <p className="text-sm text-gray-500 mb-2">Import Value (USD)</p>
                          <p className="text-4xl font-bold text-gray-800">{formatCurrency(company.import_value)}</p>
                          <p className="text-xs text-gray-400 mt-1">{company.value_range}</p>
                          <p className="text-xs text-gray-400 mt-2">Last Import: {formatDate(company.last_import_date)}</p>
                      </div>
                      <div className="bg-slate-50 p-6 rounded-lg text-center">
                          <p className="text-sm text-gray-500 mb-2">Market Share</p>
                          <MarketShareChart share={company.market_share} />
                      </div>
                      <div className="bg-slate-50 p-6 rounded-lg text-center">
                          <p className="text-sm text-gray-500 mb-2">Market Position</p>
                          <p className="text-4xl font-bold text-gray-800">{company.tier2_position}</p>
                          <p className="text-xs text-gray-400 mt-1">Tier 2 Rank (Overall: {company.total_position.replace('#','')})</p>
                      </div>
                  </section>
                  <section className="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-8 pt-6 pb-8">
                      <div>
                          <h2 className="font-bold text-gray-800 mb-4">Company Information</h2>
                          <div className="space-y-4">
                              <InfoItem icon={<LocationIcon />} label="Location">
                                {company.district && company.city ? `${company.district}, ${company.city}, ${company.country}` : company.country}
                              </InfoItem>
                              {company.company_website && (
                                <InfoItem icon={<WebsiteIcon />} label="Website">
                                      <a href={`https://${company.company_website}`} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline break-all">{company.company_website}</a>
                                </InfoItem>
                              )}
                              {company.company_linkedin && (
                                <InfoItem icon={<LinkedInIcon />} label="LinkedIn">
                                      <a href={company.company_linkedin} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline break-all">{company.company_linkedin}</a>
                                </InfoItem>
                              )}
                              {company.company_social_media && (
                                  <InfoItem icon={<SocialIcon />} label="Social Media">
                                      <a href={company.company_social_media} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline break-all">{company.company_social_media}</a>
                                </InfoItem>
                              )}
                              {company.company_phone && (
                                  <InfoItem icon={<PhoneIcon />} label="Company Phone">
                                      {company.company_phone}
                                  </InfoItem>
                              )}
                          </div>
                      </div>
                      <div>
                          <div>
                              <h2 className="font-bold text-gray-800 mb-4">Primary Contact</h2>
                              <div className="space-y-4">
                                  <InfoItem icon={<UserIcon />} label="Name">{company.contact1_name}</InfoItem>
                                  <InfoItem icon={<BriefcaseIcon />} label="Position">{company.contact1_position ? capitalizeFirstLetter(company.contact1_position) : '-'}</InfoItem>
                                  {company.contact1_email && (
                                      <InfoItem icon={<EmailIcon />} label="Email">
                                          <a href={`mailto:${company.contact1_email}`} className="text-blue-600 hover:underline break-all">{company.contact1_email}</a>
                                      </InfoItem>
                                  )}
                                  {company.contact1_linkedin && (
                                      <InfoItem icon={<LinkedInIcon />} label="LinkedIn">
                                          <a href={company.contact1_linkedin} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline break-all">{company.contact1_linkedin}</a>
                                      </InfoItem>
                                  )}
                                  {company.contact1_phone && (
                                      <InfoItem icon={<PhoneIcon />} label="Phone">
                                          {company.contact1_phone}
                                      </InfoItem>
                                  )}
                              </div>
                          </div>
                          {company.contact2_name && (
                              <div className="mt-8">
                                  <h2 className="font-bold text-gray-800 mb-4">Secondary Contact</h2>
                                  <div className="space-y-4">
                                      <InfoItem icon={<UserIcon />} label="Name">{company.contact2_name}</InfoItem>
                                      {company.contact2_position && <InfoItem icon={<BriefcaseIcon />} label="Position">{capitalizeFirstLetter(company.contact2_position)}</InfoItem>}
                                      {company.email_ceo && (
                                          <InfoItem icon={<EmailIcon />} label="Email">
                                              <a href={`mailto:${company.email_ceo}`} className="text-blue-600 hover:underline break-all">{company.email_ceo}</a>
                                          </InfoItem>
                                      )}
                                      {company.contact2_linkedin && (
                                          <InfoItem icon={<LinkedInIcon />} label="LinkedIn">
                                              <a href={company.contact2_linkedin} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline break-all">{company.contact2_linkedin}</a>
                                          </InfoItem>
                                      )}
                                      {company.contact2_phone && (
                                          <InfoItem icon={<PhoneIcon />} label="Phone">
                                              {company.contact2_phone}
                                          </InfoItem>
                                      )}
                                  </div>
                              </div>
                          )}
                      </div>
                      <div>
                          <h2 className="font-bold text-gray-800 mb-4">Pipeline Status</h2>
                          <div className="space-y-4">
                              <PipelineInfoItem icon={<TagIcon />} label="Stage">
                                  <Badge className={pipelineStatusColor[company.pipeline_stage.toLowerCase()] || 'bg-gray-100 text-gray-800'}>
                                      {capitalizeFirstLetter(company.pipeline_stage)}
                                  </Badge>
                              </PipelineInfoItem>
                              <PipelineInfoItem icon={<TagIcon />} label="Interest">
                                  <Badge className={interestLevelColor[company.interest_level.toLowerCase()] || 'bg-gray-100 text-gray-800'}>
                                      {capitalizeFirstLetter(company.interest_level)}
                                  </Badge>
                              </PipelineInfoItem>
                              <PipelineInfoItem icon={<StarIcon className="h-5 w-5 text-gray-400" />} label="Rating">
                                  <StarRating rating={company['interest_level_#']} />
                              </PipelineInfoItem>
                              <InfoItem icon={<TagIcon />} label="Reason">{company.reason}</InfoItem>
                              <InfoItem icon={<NextActionsIcon />} label="Next Actions">{company.next_actions || '-'}</InfoItem>
                              <InfoItem icon={<CalendarIcon />} label="Initial Outreach">{formatDate(company.initial_outreach_date)}</InfoItem>
                              <InfoItem icon={<CalendarIcon />} label="Last Contact">{formatDate(company.last_contact_date)}</InfoItem>
                          </div>
                      </div>
                  </section>
                  <hr />
                  <footer className="pt-6">
                      <p className="text-sm text-gray-500">IMPORTED PRODUCTS</p>
                      <p className="text-sm text-gray-800 font-medium mt-1">{company.imported_products.split(', ').map(p => capitalizeFirstLetter(p)).join(', ')}</p>
                  </footer>
              </div>
          );
      });
      Dashboard.displayName = 'Dashboard';

      const App = () => {
          const [prospects, setProspects] = useState([]);
          const [loading, setLoading] = useState(true);
          const [error, setError] = useState(null);
          const [isPrinting, setIsPrinting] = useState(false);
          const profileRefs = useMemo(() => Array(prospects.length).fill(0).map(() => createRef()), [prospects.length]);

          useEffect(() => {
              const fetchData = async () => {
                  try {
                      // Fetch the local JSON file
                      const response = await fetch('./data.json');
                      if (!response.ok) {
                          throw new Error(`Could not fetch data.json: ${response.statusText}`);
                      }
                      const jsonData = await response.json();
                      // The data is inside the 'data' property of the JSON object
                      setProspects(jsonData.data || []);
                  } catch (err) {
                      setError(err.message);
                      console.error("Failed to load company data:", err);
                  } finally {
                      setLoading(false);
                  }
              };
              fetchData();
          }, []); // Empty array means this effect runs only once

          const handlePrintAllPdfs = async () => {
              setIsPrinting(true);
              try {
                  const pdf = new jsPDF({
                      orientation: 'portrait',
                      unit: 'mm',
                      format: 'a4'
                  });
                  const pdfWidth = pdf.internal.pageSize.getWidth();

                  for (let i = 0; i < profileRefs.length; i++) {
                      const element = profileRefs[i].current;
                      if (!element) continue;

                      const canvas = await html2canvas(element, {
                          scale: 2,
                          useCORS: true,
                          backgroundColor: '#f1f5f9'
                      });
                      const imgData = canvas.toDataURL('image/jpeg', 0.9);
                      
                      const imgProps = pdf.getImageProperties(imgData);
                      const imgHeight = (imgProps.height * pdfWidth) / imgProps.width;

                      if (i > 0) {
                          pdf.addPage();
                      }
                      pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, imgHeight);
                  }
                  pdf.save('All_Company_Profiles.pdf');
              } catch (error) {
                  console.error("Error generating PDF:", error);
              } finally {
                  setIsPrinting(false);
              }
          };
          
          if (loading) {
              return (
                  <div className="min-h-screen flex items-center justify-center">
                      <p className="text-lg text-gray-600">Loading company profiles...</p>
                  </div>
              );
          }

          if (error) {
              return (
                  <div className="min-h-screen flex flex-col items-center justify-center p-4 text-center">
                      <p className="text-xl text-red-600 font-semibold">Failed to load data</p>
                      <p className="text-sm text-gray-500 mt-2">Could not fetch <code className="bg-red-100 p-1 rounded">data.json</code>. Please ensure the file exists in the same directory as the HTML file and you are using a local server (like VS Code's "Live Server" extension).</p>
                      <p className="text-sm text-gray-500 mt-1">Error details: {error}</p>
                  </div>
              );
          }

          if (!prospects || prospects.length === 0) {
              return (
                  <div className="min-h-screen flex items-center justify-center">
                      <p className="text-red-500">No company data found in data.json.</p>
                  </div>
              );
          }

          return (
              <div className="min-h-screen flex flex-col items-center justify-start p-4 sm:p-6 lg:p-8">
                <div className="w-full max-w-6xl mb-6 flex justify-end">
                      <button
                          onClick={handlePrintAllPdfs}
                          disabled={isPrinting}
                          className="flex items-center space-x-2 px-4 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-all duration-200 ease-in-out shadow-md hover:shadow-lg"
                          aria-label="Download all profiles as PDF"
                      >
                          {isPrinting ? (
                              <React.Fragment>
                                  <svg className="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                  </svg>
                                  <span>Generating...</span>
                              </React.Fragment>
                          ) : (
                              <React.Fragment>
                                  <DownloadIcon className="h-5 w-5" />
                                  <span>Download All (PDF)</span>
                              </React.Fragment>
                          )}
                      </button>
                  </div>
                <div className="space-y-8 w-full max-w-6xl">
                  {prospects.map((prospect, index) => (
                      <Dashboard key={prospect.ruc} ref={profileRefs[index]} company={prospect} />
                  ))}
                </div>
              </div>
          );
      };

      // --- RENDER ---
      const rootElement = document.getElementById('root');
      const root = ReactDOM.createRoot(rootElement);
      root.render(<App />);
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>